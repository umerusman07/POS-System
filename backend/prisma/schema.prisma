// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  Manager
  User
}

enum OrderType {
  DINE
  TAKEAWAY
  DELIVERY
}

enum OrderStatus {
  DRAFT
  PREPARING
  READY
  OUT_FOR_DELIVERY
  DELIVERED
  PICKED_UP
  FINISHED
  CANCELLED
}

enum PaymentMethod {
  CASH
  ONLINE
}

enum PaymentStatus {
  PAID
  UNPAID
}
model User {
  id        String   @id @default(uuid())
  username  String   @unique @db.VarChar(100)
  email     String   @unique @db.VarChar(255)
  password  String   @db.VarChar(255)
  role      UserRole @default(User)
  isActive  Boolean  @default(true)
  firstName String?  @db.VarChar(100)
  lastName  String?  @db.VarChar(100)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  orders Order[]

  @@map("users")
}

model MenuItem {
  id              String     @id @default(uuid())
  name            String     @db.VarChar(120)
  referenceNumber String     @unique @db.VarChar(30)
  description     String?    @db.Text
  price           Decimal    @db.Decimal(10, 2)
  isActive        Boolean    @default(true)
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt

  dealItems DealItem[]

  @@map("menu_items")
}

model Deal {
  id              String     @id @default(uuid())
  name            String     @db.VarChar(120)
  referenceNumber String     @unique @db.VarChar(30)
  description     String?    @db.Text
  price           Decimal    @db.Decimal(10, 2)
  isActive        Boolean    @default(true)
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt

  dealItems DealItem[]

  @@map("deals")
}

model DealItem {
  id          String   @id @default(uuid())
  dealId      String   @map("deal_id")
  menuItemId  String   @map("menu_item_id")
  quantity    Int
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  deal     Deal     @relation(fields: [dealId], references: [id], onDelete: Cascade)
  menuItem MenuItem @relation(fields: [menuItemId], references: [id], onDelete: Cascade)

  @@unique([dealId, menuItemId])
  @@map("deal_items")
}

model Order {
  id                String        @id @default(uuid())
  orderNumber       String        @unique @db.VarChar(30) @map("order_number")
  orderType         OrderType     @map("order_type")
  status            OrderStatus   @default(DRAFT)
  paymentMethod     PaymentMethod? @map("payment_method")
  paymentStatus     PaymentStatus @default(UNPAID) @map("payment_status")
  customerName      String?       @db.VarChar(100) @map("customer_name")
  customerPhone     String?       @db.VarChar(30) @map("customer_phone")
  customerAddress   String?       @db.Text @map("customer_address")
  subtotal          Decimal       @db.Decimal(10, 2) @default(0)
  deliveryCharges   Decimal       @db.Decimal(10, 2) @default(0) @map("delivery_charges")
  discount          Decimal       @db.Decimal(10, 2) @default(0)
  printedAt         DateTime?     @map("printed_at")
  printCount        Int           @default(0) @map("print_count")
  createdByUserId   String        @map("created_by_user_id")
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  createdByUser User       @relation(fields: [createdByUserId], references: [id])
  orderLines    OrderLine[]

  @@map("orders")
}

enum ProductType {
  ITEM
  DEAL
}

model OrderLine {
  id              String      @id @default(uuid())
  orderId         String      @map("order_id")
  productType     ProductType @map("product_type")
  productId       String      @map("product_id")
  nameAtSale      String      @db.VarChar(120) @map("name_at_sale")
  unitPriceAtSale Decimal     @db.Decimal(10, 2) @map("unit_price_at_sale")
  quantity        Int
  lineTotal       Decimal     @db.Decimal(10, 2) @map("line_total")
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("order_lines")
}

